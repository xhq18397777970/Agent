# MCP Agent Flaskåç«¯æœåŠ¡

## ğŸ¯ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯MCP Agentçš„Flaskåç«¯ç‰ˆæœ¬ï¼Œå°†åŸæ¥çš„ç»ˆç«¯åº”ç”¨æ”¹é€ ä¸ºWebæœåŠ¡ï¼Œæ”¯æŒé€šè¿‡æµè§ˆå™¨è¿›è¡Œæ™ºèƒ½å¯¹è¯ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸŒ **Webç•Œé¢**: ç°ä»£åŒ–çš„å¯¹è¯ç•Œé¢ï¼Œæ”¯æŒå®æ—¶äº¤äº’
- ğŸ”§ **å·¥å…·é›†æˆ**: æ”¯æŒå¤©æ°”æŸ¥è¯¢ã€æ–‡ä»¶æ“ä½œç­‰MCPå·¥å…·
- ğŸ—ï¸ **åˆ†å±‚æ¶æ„**: ä¸šåŠ¡é€»è¾‘ä¸Webå±‚å®Œå…¨è§£è€¦
- ğŸ“± **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- ğŸš€ **æ˜“äºæ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ·»åŠ æ–°åŠŸèƒ½

## ğŸ“ é¡¹ç›®ç»“æ„

```
Agent/
â”œâ”€â”€ app/                        # Flaskåº”ç”¨
â”‚   â”œâ”€â”€ __init__.py            # åº”ç”¨å·¥å‚
â”‚   â”œâ”€â”€ api/                   # APIæ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ chat.py           # å¯¹è¯API
â”‚   â”‚   â”œâ”€â”€ tools.py          # å·¥å…·API
â”‚   â”‚   â””â”€â”€ health.py         # å¥åº·æ£€æŸ¥API
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ mcp_manager.py    # MCPç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ llm_client.py     # LLMå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ chat_service.py   # å¯¹è¯æœåŠ¡
â”‚   â””â”€â”€ static/                # é™æ€æ–‡ä»¶
â”‚       â””â”€â”€ index.html        # å‰ç«¯é¡µé¢
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶(å¤ç”¨åŸæœ‰)
â”œâ”€â”€ servers/                   # MCPæœåŠ¡å™¨(å¤ç”¨åŸæœ‰)
â”œâ”€â”€ requirements_flask.txt     # Flaskç‰ˆæœ¬ä¾èµ–
â”œâ”€â”€ start_flask.py            # å¯åŠ¨è„šæœ¬
â””â”€â”€ app.py                    # Flaskåº”ç”¨å…¥å£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…Flaskç‰ˆæœ¬ä¾èµ–
pip install -r requirements_flask.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

ç¡®ä¿`.env`æ–‡ä»¶åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```env
# DeepSeek APIé…ç½®
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_BASE_URL=https://api.deepseek.com
DEEPSEEK_MODEL=deepseek-chat

# å¤©æ°”APIé…ç½®
OPENWEATHER_API_KEY=your_weather_api_key

# Flaské…ç½®(å¯é€‰)
FLASK_HOST=127.0.0.1
FLASK_PORT=5000
FLASK_DEBUG=True
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼1: ä½¿ç”¨å¯åŠ¨è„šæœ¬(æ¨è)
python start_flask.py

# æ–¹å¼2: ç›´æ¥è¿è¡Œ
python app.py
```

### 4. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://127.0.0.1:5000

## ğŸ“¡ APIæ¥å£

### å¯¹è¯æ¥å£

#### POST /api/chat
å‘é€æ¶ˆæ¯è¿›è¡Œå¯¹è¯

**è¯·æ±‚:**
```json
{
    "message": "æŸ¥è¯¢åŒ—äº¬å¤©æ°”",
    "session_id": "å¯é€‰çš„ä¼šè¯ID"
}
```

**å“åº”:**
```json
{
    "success": true,
    "data": {
        "response": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ™´æœ—...",
        "session_id": "session_123",
        "tool_calls": [...],
        "message_count": 5
    }
}
```

#### GET /api/chat/history/{session_id}
è·å–å¯¹è¯å†å²

#### DELETE /api/chat/clear/{session_id}
æ¸…é™¤å¯¹è¯å†å²

### å·¥å…·æ¥å£

#### GET /api/tools
è·å–æ‰€æœ‰å¯ç”¨å·¥å…·

**å“åº”:**
```json
{
    "success": true,
    "data": {
        "tools": [
            {
                "name": "weather_query_weather",
                "description": "æŸ¥è¯¢å¤©æ°”ä¿¡æ¯",
                "server": "weather",
                "parameters": {...}
            }
        ],
        "count": 2
    }
}
```

#### GET /api/tools/servers
è·å–å·¥å…·æœåŠ¡å™¨çŠ¶æ€

### å¥åº·æ£€æŸ¥

#### GET /api/health
åŸºç¡€å¥åº·æ£€æŸ¥

#### GET /api/health/detailed
è¯¦ç»†å¥åº·æ£€æŸ¥

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

1. **APIå±‚** (`app/api/`): å¤„ç†HTTPè¯·æ±‚ï¼Œå‚æ•°éªŒè¯ï¼Œå“åº”æ ¼å¼åŒ–
2. **ä¸šåŠ¡é€»è¾‘å±‚** (`app/core/`): æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼Œç‹¬ç«‹äºWebæ¡†æ¶
3. **æ•°æ®å±‚**: é…ç½®ç®¡ç†ï¼ŒMCPæœåŠ¡å™¨è¿æ¥

### æ ¸å¿ƒç»„ä»¶

- **ChatService**: å¯¹è¯æœåŠ¡ï¼Œæ•´åˆMCPå’ŒLLM
- **MCPManager**: MCPæœåŠ¡å™¨ç®¡ç†
- **LLMClient**: DeepSeek APIå®¢æˆ·ç«¯

### è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—èŒè´£æ˜ç¡®
- **ä¾èµ–æ³¨å…¥**: æ¾è€¦åˆè®¾è®¡
- **å¼‚æ­¥æ”¯æŒ**: ä¿æŒé«˜æ€§èƒ½
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„APIæ¥å£

1. åœ¨`app/api/`ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æ¨¡å—
2. å®šä¹‰è·¯ç”±å’Œå¤„ç†å‡½æ•°
3. åœ¨`app/api/__init__.py`ä¸­å¯¼å…¥

```python
# app/api/new_feature.py
from app.api import api_bp

@api_bp.route('/new-feature', methods=['GET'])
def new_feature():
    return jsonify({"message": "New feature"})
```

### æ‰©å±•ä¸šåŠ¡é€»è¾‘

1. åœ¨`app/core/`ç›®å½•ä¸‹æ·»åŠ æ–°çš„æœåŠ¡ç±»
2. åœ¨APIå±‚è°ƒç”¨ä¸šåŠ¡é€»è¾‘
3. ä¿æŒä¸šåŠ¡é€»è¾‘ä¸Webå±‚è§£è€¦

### æ·»åŠ æ–°çš„MCPå·¥å…·

1. åœ¨`servers/`ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æœåŠ¡å™¨æ–‡ä»¶
2. åœ¨`config/servers_config.json`ä¸­æ·»åŠ é…ç½®
3. é‡å¯æœåŠ¡å³å¯è‡ªåŠ¨åŠ è½½

## ğŸ§ª æµ‹è¯•

### å¥åº·æ£€æŸ¥
```bash
curl http://127.0.0.1:5000/api/health
```

### å¯¹è¯æµ‹è¯•
```bash
curl -X POST http://127.0.0.1:5000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½"}'
```

### å·¥å…·åˆ—è¡¨
```bash
curl http://127.0.0.1:5000/api/tools
```

## ğŸš€ éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ
```bash
python start_flask.py
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨Gunicorn
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:create_app()
```

### Dockeréƒ¨ç½²
```dockerfile
FROM python:3.10-slim
WORKDIR /app
COPY requirements_flask.txt .
RUN pip install -r requirements_flask.txt
COPY . .
EXPOSE 5000
CMD ["python", "start_flask.py"]
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæ•´å®‰è£…
   - éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
   - ç¡®è®¤ç«¯å£æœªè¢«å ç”¨

2. **APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥DeepSeek APIå¯†é’¥
   - éªŒè¯ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

3. **å·¥å…·è°ƒç”¨å¼‚å¸¸**
   - ç¡®è®¤MCPæœåŠ¡å™¨é…ç½®
   - æ£€æŸ¥æœåŠ¡å™¨æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - éªŒè¯å·¥å…·å‚æ•°æ ¼å¼

### æ—¥å¿—æŸ¥çœ‹

æœåŠ¡è¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- æœåŠ¡å¯åŠ¨çŠ¶æ€
- MCPæœåŠ¡å™¨è¿æ¥æƒ…å†µ
- APIè¯·æ±‚å¤„ç†è¿‡ç¨‹
- é”™è¯¯å’Œå¼‚å¸¸ä¿¡æ¯

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… å®Œæˆç»ˆç«¯åº”ç”¨åˆ°Flask WebæœåŠ¡çš„æ”¹é€ 
- âœ… å®ç°åˆ†å±‚æ¶æ„è®¾è®¡
- âœ… åˆ›å»ºç°ä»£åŒ–Webç•Œé¢
- âœ… æ”¯æŒå®æ—¶å¯¹è¯å’Œå·¥å…·è°ƒç”¨
- âœ… å®Œå–„çš„APIæ¥å£å’Œæ–‡æ¡£

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚